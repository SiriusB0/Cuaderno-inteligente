# üìö Arquitectura del Cuaderno Inteligente

## üìã √çndice
1. [Visi√≥n General](#visi√≥n-general)
2. [Estructura de Archivos](#estructura-de-archivos)
3. [Flujo de Datos](#flujo-de-datos)
4. [Componentes Principales](#componentes-principales)
5. [Vistas](#vistas)
6. [Gesti√≥n de Estado](#gesti√≥n-de-estado)
7. [Convenciones de C√≥digo](#convenciones-de-c√≥digo)

---

## üéØ Visi√≥n General

**Cuaderno Inteligente** es una aplicaci√≥n SPA (Single Page Application) para gesti√≥n de estudios con las siguientes caracter√≠sticas:

- ‚úÖ Gesti√≥n de materias y temas
- ‚úÖ Editor de texto enriquecido
- ‚úÖ Sistema de recursos (PDFs, im√°genes, audio)
- ‚úÖ T√©cnica Pomodoro integrada
- ‚úÖ Calendario de eventos
- ‚úÖ Dashboard con estad√≠sticas
- ‚úÖ Modo presentaci√≥n

---

## üìÅ Estructura de Archivos

```
Cuaderno-inteligente/
‚îÇ
‚îú‚îÄ‚îÄ index.html                 # Punto de entrada √∫nico
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ styles-new.css        # Estilos globales
‚îÇ
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îú‚îÄ‚îÄ app.js                # Inicializaci√≥n de la aplicaci√≥n
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ core/                 # üî∑ N√öCLEO DEL SISTEMA
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Router.js         # Navegaci√≥n entre vistas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DataManager.js    # Gesti√≥n centralizada de datos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StorageManager.js # Persistencia en localStorage
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ views/                # üñºÔ∏è VISTAS PRINCIPALES
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardView.js  # Vista inicial con resumen
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SubjectsView.js   # Lista de materias
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TopicsView.js     # Temas de una materia
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StudyView.js      # Editor de texto (VISTA PRINCIPAL)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PresentationView.js # Modo presentaci√≥n
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/           # üß© COMPONENTES REUTILIZABLES
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EventsManager.js     # Gesti√≥n de eventos/entregas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ResourceManager.js   # Gesti√≥n de recursos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PomodoroManager.js   # T√©cnica Pomodoro
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NotificationManager.js # Sistema de notificaciones
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/                # üõ†Ô∏è UTILIDADES
‚îÇ       ‚îî‚îÄ‚îÄ [utilidades futuras]
‚îÇ
‚îî‚îÄ‚îÄ assets/                   # üì¶ RECURSOS EST√ÅTICOS
    ‚îî‚îÄ‚îÄ [im√°genes, iconos]
```

---

## üîÑ Flujo de Datos

### 1Ô∏è‚É£ **Arquitectura de Capas**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           CAPA DE VISTA                 ‚îÇ
‚îÇ  (DashboardView, TopicsView, etc.)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        CAPA DE COMPONENTES              ‚îÇ
‚îÇ  (EventsManager, ResourceManager, etc.)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         CAPA DE DATOS                   ‚îÇ
‚îÇ         (DataManager)                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      CAPA DE PERSISTENCIA               ‚îÇ
‚îÇ       (StorageManager)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2Ô∏è‚É£ **Sistema de Eventos**

**DataManager** act√∫a como Event Bus:

```javascript
// Emisi√≥n de evento
dataManager.emit('resourceAdded', { resourceId, topicId });

// Escucha de evento
dataManager.on('resourceAdded', (event) => {
    // Reaccionar al cambio
});
```

**Eventos Principales:**
- `resourceAdded` / `resourceDeleted` - Cambios en recursos
- `eventCreated` / `eventUpdated` / `eventDeleted` - Cambios en eventos
- `progressUpdated` - Actualizaci√≥n de progreso
- `topicCreated` / `topicUpdated` / `topicDeleted` - Cambios en temas

---

## üß© Componentes Principales

### üìã EventsManager
**Prop√≥sito:** Gesti√≥n de eventos y entregas

**Responsabilidades:**
- Crear/editar/eliminar eventos
- Mostrar widget en header de StudyView
- Sincronizar con TopicsView sidebar
- Filtrar eventos completados

**Archivo:** `js/components/EventsManager.js`

---

### üì¶ ResourceManager
**Prop√≥sito:** Gesti√≥n de recursos (PDFs, im√°genes, audio)

**Responsabilidades:**
- Subir archivos (m√°x 20MB)
- Mostrar recursos en sidebar
- Abrir visualizadores (PDF, imagen, audio)
- Reproductor de audio minimizable
- Sincronizaci√≥n entre TopicsView y StudyView

**Archivo:** `js/components/ResourceManager.js`

---

### üçÖ PomodoroManager
**Prop√≥sito:** T√©cnica Pomodoro para sesiones de estudio

**Responsabilidades:**
- Configurar tiempos de trabajo/descanso
- Timer con cuenta regresiva
- M√∫sica de fondo personalizable
- Alarma al finalizar
- Widget flotante y pesta√±a lateral
- Guardar estad√≠sticas de estudio

**Archivo:** `js/components/PomodoroManager.js`

---

### üîî NotificationManager
**Prop√≥sito:** Sistema de notificaciones visuales

**Responsabilidades:**
- Mostrar notificaciones (success, error, warning, info)
- Auto-cierre configurable
- Animaciones de entrada/salida
- Centradas en la parte superior

**Archivo:** `js/components/NotificationManager.js`

---

## üñºÔ∏è Vistas

### üè† DashboardView
**Ruta:** `/dashboard`

**Funcionalidad:**
- Vista inicial de la aplicaci√≥n
- Resumen de materias con progreso
- "Continuar donde lo dejaste"
- Pr√≥ximas entregas
- Gr√°fico de estudio semanal

---

### üìö SubjectsView
**Ruta:** `/subjects`

**Funcionalidad:**
- Lista/Grid de materias
- Crear nueva materia
- Editar/eliminar materias
- Navegar a TopicsView

---

### üìñ TopicsView
**Ruta:** `/topics/:subjectId`

**Funcionalidad:**
- Lista de temas de una materia
- Crear/editar/eliminar temas
- Subtareas por tema
- Sidebar con recursos y eventos
- Bot√≥n "Iniciar Sesi√≥n" / "Entrar"

---

### ‚úçÔ∏è StudyView (PRINCIPAL)
**Ruta:** `/study/:subjectId/:topicId`

**Funcionalidad:**
- Editor de texto enriquecido (ContentEditable)
- Toolbar con formato (negrita, cursiva, listas, etc.)
- P√°ginas m√∫ltiples (texto, Excalidraw, tabla)
- Sidebar izquierdo: Lista de p√°ginas
- Sidebar derecho: Recursos
- Header con eventos y botones
- Carrusel de acciones (Pomodoro, paneles, etc.)
- Modo sin distracciones (ocultar header)
- Timer de sesi√≥n de estudio
- Auto-guardado

**Archivo:** `js/views/StudyView.js` (‚ö†Ô∏è 146KB - NECESITA REFACTORIZACI√ìN)

---

### üé• PresentationView
**Ruta:** `/presentation/:subjectId/:topicId`

**Funcionalidad:**
- Modo presentaci√≥n fullscreen
- Navegar entre p√°ginas con flechas
- Salir con Esc

---

## üóÑÔ∏è Gesti√≥n de Estado

### DataManager
**Archivo:** `js/core/DataManager.js`

**Estructura de datos:**
```javascript
{
    userName: 'Usuario',
    
    subjects: [
        {
            id: 'subj_xxx',
            name: 'C√°lculo I',
            description: 'Derivadas e integrales',
            color: 'indigo',
            lastAccessed: '2025-01-15T10:30:00'
        }
    ],
    
    topics: {
        'subj_xxx': [
            {
                id: 'topic_xxx',
                name: 'Derivadas',
                pages: [
                    {
                        id: 'page_xxx',
                        type: 'text', // 'text' | 'excalidraw' | 'table'
                        content: '...',
                        order: 0
                    }
                ]
            }
        ]
    },
    
    subtasks: {
        'topic_xxx': [
            {
                id: 'subtask_xxx',
                name: 'Resolver ejercicios',
                completed: false
            }
        ]
    },
    
    events: {
        'subj_xxx': [
            {
                id: 'event_xxx',
                title: 'Examen Final',
                description: 'Incluye todo el semestre',
                date: '2025-10-07T15:15:00',
                type: 'exam', // 'exam' | 'assignment' | 'presentation' | 'class'
                completed: false
            }
        ]
    },
    
    resources: {
        'subj_xxx': [
            {
                id: 'res_xxx',
                name: 'Pr√°ctica 1.pdf',
                type: 'pdf', // 'image' | 'pdf' | 'text' | 'audio'
                data: 'data:application/pdf;base64,...',
                size: 684870,
                uploadedAt: '2025-09-30T15:00:00'
            }
        ]
    },
    
    studyStats: {
        '2025-01-15': {
            'subj_xxx': 45 // minutos estudiados
        }
    },
    
    activeStudySession: {
        subjectId: 'subj_xxx',
        startTime: '2025-01-15T10:00:00',
        pausedTime: 0,
        totalTime: 0
    }
}
```

---

## üìù Convenciones de C√≥digo

### üé® Estilos CSS

```css
/* ===================================
   SECCI√ìN: Descripci√≥n de la secci√≥n
   =================================== */

/* Subsecci√≥n espec√≠fica */
.clase-especifica {
    /* Propiedad con comentario si es complejo */
    property: value;
}
```

### üîß JavaScript

```javascript
/**
 * Descripci√≥n de la clase/m√©todo
 * 
 * @param {Type} paramName - Descripci√≥n del par√°metro
 * @returns {Type} Descripci√≥n del retorno
 */
class MiClase {
    /**
     * Constructor
     */
    constructor(param) {
        // Inicializaci√≥n
    }
    
    // ==================== SECCI√ìN ====================
    
    /**
     * M√©todo p√∫blico
     */
    metodoPublico() {
        // Implementaci√≥n
    }
    
    /**
     * M√©todo privado (por convenci√≥n)
     */
    _metodoPrivado() {
        // Implementaci√≥n
    }
}
```

### üì¶ Nomenclatura

- **Archivos:** PascalCase para clases (`StudyView.js`)
- **Clases:** PascalCase (`class StudyView`)
- **M√©todos:** camelCase (`renderContent()`)
- **Variables:** camelCase (`currentSubject`)
- **Constantes:** UPPER_SNAKE_CASE (`MAX_FILE_SIZE`)
- **IDs HTML:** kebab-case (`study-content-grid`)
- **Eventos custom:** camelCase (`resourceAdded`)

---

## ‚ö†Ô∏è √Åreas que Necesitan Refactorizaci√≥n

### üî¥ CR√çTICO: StudyView.js (146KB)

**Problema:** Archivo demasiado grande, m√∫ltiples responsabilidades

**Soluci√≥n propuesta:**
```
StudyView.js (coordinador principal)
‚îú‚îÄ‚îÄ TextEditor.js (l√≥gica del editor)
‚îú‚îÄ‚îÄ PageManager.js (gesti√≥n de p√°ginas)
‚îú‚îÄ‚îÄ ExcalidrawManager.js (canvas de dibujo)
‚îú‚îÄ‚îÄ TableManager.js (tablas)
‚îî‚îÄ‚îÄ ToolbarManager.js (toolbar del editor)
```

### üü° MEDIO: PomodoroManager.js (43KB)

**Problema:** Muchas funciones mezcladas

**Soluci√≥n propuesta:**
```
PomodoroManager.js (coordinador)
‚îú‚îÄ‚îÄ PomodoroTimer.js (l√≥gica del timer)
‚îú‚îÄ‚îÄ PomodoroWidget.js (UI del widget)
‚îî‚îÄ‚îÄ PomodoroAudio.js (m√∫sica y alarmas)
```

### üü¢ BUENO: El resto de archivos est√°n bien organizados

---

## üöÄ Pr√≥ximos Pasos de Mejora

1. ‚úÖ **Documentar c√≥digo existente** (comentarios claros)
2. üîÑ **Refactorizar StudyView.js** (dividir en m√≥dulos)
3. üîÑ **Refactorizar PomodoroManager.js**
4. üìä **Agregar tests unitarios**
5. üé® **Crear gu√≠a de estilos visual**
6. üìö **Documentaci√≥n de usuario**

---

## üìû Contacto y Contribuci√≥n

Para contribuir al proyecto:
1. Seguir las convenciones establecidas
2. Documentar todo c√≥digo nuevo
3. Mantener la modularidad
4. Escribir c√≥digo limpio y legible

---

**√öltima actualizaci√≥n:** 2025-09-30
**Versi√≥n:** 1.0.0
